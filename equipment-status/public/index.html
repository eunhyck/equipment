<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <title>장비 상태 현황</title>
    <style>
      :root {
        --bg-gradient-start: #020617;
        --bg-gradient-end: #020617;
        --card-bg: rgba(15, 23, 42, 0.96);
        --card-border: rgba(148, 163, 184, 0.2);
        --accent: #38bdf8;
        --accent-soft: rgba(56, 189, 248, 0.16);
        --danger: #f97373;
        --warning: #eab308;
        --success: #22c55e;
        --text-main: #e5e7eb;
        --text-sub: #94a3b8;
        --radius-lg: 18px;
        --radius-sm: 10px;
        --shadow-card: 0 20px 60px rgba(15, 23, 42, 0.9);
        --shadow-soft: 0 12px 34px rgba(15, 23, 42, 0.85);
        --border-subtle: 1px solid rgba(148, 163, 184, 0.3);
        --transition-fast: 0.15s ease-out;
        --transition-medium: 0.25s ease-out;
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        min-height: 100vh;
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
          sans-serif;
        color: var(--text-main);
        background: radial-gradient(
          circle at top,
          #1f2937 0,
          #020617 55%,
          #000 100%
        );
        display: flex;
        justify-content: center;
        padding: 40px 16px 60px;
      }

      body::before {
        content: "";
        position: fixed;
        inset: 0;
        background: radial-gradient(
            circle at 10% 0%,
            rgba(56, 189, 248, 0.14),
            transparent 55%
          ),
          radial-gradient(
            circle at 90% 100%,
            rgba(52, 211, 153, 0.12),
            transparent 55%
          );
        opacity: 0.9;
        pointer-events: none;
        z-index: -1;
      }

      .app-shell {
        width: 100%;
        max-width: 1200px;
        border-radius: 28px;
        border: 1px solid rgba(148, 163, 184, 0.28);
        background: radial-gradient(circle at top left, #020617, #020617);
        box-shadow: 0 30px 80px rgba(15, 23, 42, 0.9);
        overflow: hidden;
        backdrop-filter: blur(20px) saturate(1.3);
        display: flex;
        flex-direction: column;
      }

      /* 헤더 & 탭 */

      header {
        padding: 18px 26px 14px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        border-bottom: 1px solid rgba(30, 64, 175, 0.3);
        background: linear-gradient(135deg, #020617, #020617);
      }

      .title-block {
        display: flex;
        flex-direction: column;
        gap: 4px;
      }

      h1 {
        font-size: 22px;
        margin: 0;
        letter-spacing: 0.16em;
        text-transform: uppercase;
        display: flex;
        align-items: center;
        gap: 10px;
        color: #f9fafb;
      }

      h1::before {
        content: "";
        width: 8px;
        height: 26px;
        border-radius: 999px;
        background: linear-gradient(135deg, #38bdf8, #22c55e);
        box-shadow: 0 0 22px rgba(56, 189, 248, 0.9);
      }

      .title-sub {
        font-size: 11px;
        color: var(--text-sub);
        letter-spacing: 0.12em;
        text-transform: uppercase;
      }

      .nav-tabs {
        display: inline-flex;
        padding: 3px;
        border-radius: 999px;
        background: rgba(15, 23, 42, 0.85);
        border: 1px solid rgba(51, 65, 85, 0.9);
        box-shadow: 0 12px 30px rgba(15, 23, 42, 0.9);
        gap: 4px;
      }

      .nav-tab {
        position: relative;
        padding: 6px 18px;
        font-size: 11px;
        letter-spacing: 0.16em;
        text-transform: uppercase;
        border-radius: 999px;
        border: none;
        background: transparent;
        color: var(--text-sub);
        cursor: pointer;
        transition: color var(--transition-fast),
          transform var(--transition-fast), background var(--transition-fast);
      }

      .nav-tab span {
        position: relative;
        z-index: 1;
      }

      .nav-tab::before {
        content: "";
        position: absolute;
        inset: 2px;
        border-radius: 999px;
        background: linear-gradient(135deg, #0f172a, #020617);
        opacity: 0;
        transition: opacity var(--transition-fast);
      }

      .nav-tab.active {
        color: #e5f3ff;
        transform: translateY(-1px);
        background: linear-gradient(135deg, #0f172a, #020617);
        box-shadow: 0 14px 32px rgba(15, 23, 42, 0.9);
      }

      .nav-tab.active::before {
        opacity: 1;
      }

      .nav-tab:hover:not(.active) {
        color: var(--accent);
        transform: translateY(-1px);
      }

      main {
        padding: 20px 24px 26px;
        display: flex;
        flex-direction: column;
        gap: 16px;
      }

      .view {
        display: none;
        border-radius: 22px;
        border: var(--border-subtle);
        background: var(--card-bg);
        box-shadow: var(--shadow-card);
        padding: 18px 20px 20px;
        min-height: 340px;
      }

      .view.active {
        display: block;
      }

      .view h2 {
        margin: 0 0 14px;
        font-size: 16px;
        letter-spacing: 0.12em;
        text-transform: uppercase;
        color: var(--text-sub);
      }

      /* 등록/수정 폼 공통 */

      .form-grid {
        display: grid;
        grid-template-columns: repeat(4, minmax(0, 1fr));
        gap: 12px 18px;
        align-items: end;
        margin-top: 4px;
      }

      .form-field {
        display: flex;
        flex-direction: column;
        gap: 4px;
      }

      label {
        font-size: 11px;
        font-weight: 600;
        letter-spacing: 0.12em;
        text-transform: uppercase;
        color: var(--text-sub);
      }

      input,
      select {
        font: inherit;
        padding: 8px 9px;
        border-radius: var(--radius-sm);
        border: 1px solid rgba(148, 163, 184, 0.4);
        background: rgba(15, 23, 42, 0.88);
        color: var(--text-main);
        outline: none;
        transition: border-color var(--transition-fast),
          box-shadow var(--transition-fast),
          background-color var(--transition-fast), transform 0.06s ease-out;
      }

      input::placeholder {
        color: rgba(148, 163, 184, 0.7);
      }

      input:focus,
      select:focus {
        border-color: var(--accent);
        box-shadow: 0 0 0 1px rgba(56, 189, 248, 0.6);
        background: rgba(15, 23, 42, 0.98);
        transform: translateY(-1px);
      }

      .primary-btn {
        padding: 10px 20px;
        border-radius: 999px;
        border: none;
        background: linear-gradient(135deg, #38bdf8, #22c55e);
        color: #020617;
        font-weight: 700;
        letter-spacing: 0.16em;
        text-transform: uppercase;
        cursor: pointer;
        box-shadow: 0 18px 50px rgba(15, 23, 42, 1);
        transition: transform var(--transition-medium),
          box-shadow var(--transition-medium), filter var(--transition-medium);
      }

      .primary-btn:hover {
        transform: translateY(-1px) scale(1.01);
        box-shadow: 0 22px 60px rgba(15, 23, 42, 1);
        filter: brightness(1.02);
      }

      .primary-btn:active {
        transform: translateY(1px) scale(0.99);
        box-shadow: 0 6px 20px rgba(15, 23, 42, 0.9);
      }

      .form-actions {
        display: flex;
        gap: 10px;
        align-items: center;
        margin-top: 10px;
      }

      .muted-text {
        font-size: 11px;
        color: var(--text-sub);
      }

      /* 조회 테이블 */

      .table-header-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 12px;
        margin-bottom: 8px;
      }

      .table-header-row-title {
        font-size: 12px;
        letter-spacing: 0.16em;
        text-transform: uppercase;
        color: var(--text-sub);
      }

      #btnRefresh {
        padding: 7px 14px;
        border-radius: 999px;
        border: 1px solid rgba(148, 163, 184, 0.55);
        background: rgba(15, 23, 42, 0.9);
        color: var(--text-sub);
        font-size: 11px;
        letter-spacing: 0.16em;
        text-transform: uppercase;
        cursor: pointer;
        transition: background-color var(--transition-fast),
          color var(--transition-fast), border-color var(--transition-fast),
          transform var(--transition-fast);
      }

      #btnRefresh:hover {
        background: var(--accent-soft);
        color: var(--accent);
        border-color: var(--accent);
        transform: translateY(-1px);
      }

      table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 6px;
        border-radius: 18px;
        overflow: hidden;
        background: radial-gradient(circle at top left, #111827, #020617);
        box-shadow: var(--shadow-soft);
        font-size: 13px;
      }

      thead {
        background: linear-gradient(135deg, #020617, #020617);
      }

      th,
      td {
        padding: 9px 10px;
        text-align: center;
        border-bottom: 1px solid rgba(30, 41, 59, 0.95);
      }

      th {
        font-weight: 600;
        letter-spacing: 0.14em;
        text-transform: uppercase;
        color: var(--text-sub);
        border-bottom: 1px solid rgba(51, 65, 85, 0.9);
        position: sticky;
        top: 0;
        z-index: 1;
        background: linear-gradient(135deg, #020617, #020617);
      }

      tbody tr {
        transition: background-color var(--transition-fast),
          transform var(--transition-fast), box-shadow var(--transition-fast);
      }

      tbody tr:nth-child(even) {
        background-color: rgba(15, 23, 42, 0.86);
      }

      tbody tr:nth-child(odd) {
        background-color: rgba(15, 23, 42, 0.72);
      }

      tbody tr:hover {
        background-color: rgba(30, 64, 175, 0.55);
        transform: translateY(-1px);
        box-shadow: 0 12px 28px rgba(15, 23, 42, 0.9);
      }

      td button {
        font: inherit;
        padding: 5px 9px;
        border-radius: 999px;
        border: 1px solid rgba(148, 163, 184, 0.5);
        background: rgba(15, 23, 42, 0.9);
        color: var(--text-main);
        font-size: 11px;
        letter-spacing: 0.08em;
        text-transform: uppercase;
        cursor: pointer;
        margin: 2px 1px;
        transition: background-color var(--transition-fast),
          border-color var(--transition-fast), color var(--transition-fast),
          transform var(--transition-fast);
      }

      td button:hover {
        transform: translateY(-1px);
        background: rgba(15, 23, 42, 0.98);
      }

      td button[data-action="delete"] {
        border-color: rgba(248, 113, 113, 0.85);
        color: var(--danger);
      }

      td button[data-action="detail"] {
        border-color: var(--accent);
        color: var(--accent);
      }

      .td-actions {
        text-align: center; /* 예비용 */
        padding-right: 0;
        white-space: nowrap;
      }

      .td-actions button {
        margin: 2px 4px; /* 버튼 사이 간격 */
      }

      .status-normal,
      .status-check,
      .status-error {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        min-width: 70px;
        padding: 3px 10px;
        border-radius: 999px;
        font-size: 11px;
        font-weight: 700;
        letter-spacing: 0.12em;
        text-transform: uppercase;
        box-shadow: 0 0 0 1px rgba(15, 23, 42, 0.7),
          0 8px 18px rgba(15, 23, 42, 0.8);
      }

      .status-normal {
        background: rgba(34, 197, 94, 0.18);
        color: var(--success);
        border: 1px solid rgba(34, 197, 94, 0.85);
      }

      .status-check {
        background: rgba(234, 179, 8, 0.16);
        color: var(--warning);
        border: 1px solid rgba(234, 179, 8, 0.9);
      }

      .status-error {
        background: rgba(248, 113, 113, 0.14);
        color: var(--danger);
        border: 1px solid rgba(248, 113, 113, 0.9);
      }

      td:nth-last-child(2) {
        font-size: 11px;
        color: var(--text-sub);
        white-space: nowrap;
      }

      /* 수정 뷰 전용 */

      .badge-id {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        padding: 4px 10px;
        border-radius: 999px;
        border: 1px solid rgba(148, 163, 184, 0.7);
        font-size: 11px;
        letter-spacing: 0.12em;
        text-transform: uppercase;
        color: var(--text-sub);
        background: rgba(15, 23, 42, 0.9);
        gap: 6px;
      }

      .badge-id span {
        color: #e5e7eb;
        font-weight: 600;
      }

      /* 반응형 */

      @media (max-width: 960px) {
        .form-grid {
          grid-template-columns: repeat(2, minmax(0, 1fr));
        }

        header {
          flex-direction: column;
          align-items: flex-start;
          gap: 12px;
        }
      }

      @media (max-width: 640px) {
        .form-grid {
          grid-template-columns: 1fr;
        }

        main {
          padding: 16px 14px 20px;
        }

        th,
        td {
          padding: 7px 6px;
        }

        table {
          font-size: 12px;
        }
      }
    </style>
  </head>
  <body>
    <div class="app-shell">
      <header>
        <div class="title-block">
          <h1>장비 상태 현황</h1>
          <div class="title-sub">장비 등록 · 상태 조회 · 상세 수정</div>
        </div>

        <div class="nav-tabs">
          <button class="nav-tab" data-view="register">
            <span>장비 등록</span>
          </button>
          <button class="nav-tab active" data-view="list">
            <span>장비 조회</span>
          </button>
        </div>
      </header>

      <main>
        <!-- 장비 등록 -->
        <section id="view-register" class="view">
          <h2>장비 등록</h2>
          <div class="form-grid">
            <div class="form-field">
              <label for="equipName">장비명</label>
              <input
                type="text"
                id="equipName"
                placeholder="예) 네트워크 스위치 1번"
              />
            </div>
            <div class="form-field">
              <label for="manager">담당자</label>
              <input type="text" id="manager" placeholder="예) 홍길동" />
            </div>
            <div class="form-field">
              <label for="location">위치</label>
              <input
                type="text"
                id="location"
                placeholder="예) 서버실 랙 A-3"
              />
            </div>
            <div class="form-field">
              <label for="status">상태</label>
              <select id="status">
                <option value="정상">정상</option>
                <option value="점검중">점검중</option>
                <option value="장애">장애</option>
              </select>
            </div>
          </div>
          <div class="form-actions">
            <button id="btnAdd" class="primary-btn">등록</button>
            <span class="muted-text"
              >※ 신규 장비 등록 후 “장비 조회” 탭에서 확인 및 상세 수정을 할 수
              있습니다.</span
            >
          </div>
        </section>

        <!-- 장비 조회 -->
        <section id="view-list" class="view active">
          <div class="table-header-row">
            <div class="table-header-row-title">장비 목록</div>
            <button id="btnRefresh">새로고침</button>
          </div>

          <table>
            <thead>
              <tr>
                <th>ID</th>
                <th>장비명</th>
                <th>담당자</th>
                <th>위치</th>
                <th>상태</th>
                <th>최종 변경일시</th>
                <th>상세 수정 / 삭제</th>
              </tr>
            </thead>
            <tbody id="equipmentBody">
              <!-- JS로 채움 -->
            </tbody>
          </table>
        </section>

        <!-- 장비 수정 (탭은 없지만 상세수정 클릭 시 진입) -->
        <section id="view-edit" class="view">
          <h2>장비 상세 수정</h2>
          <div class="form-actions" style="margin-bottom: 8px">
            <span id="edit-info" class="badge-id">선택된 장비 없음</span>
          </div>
          <div class="form-grid">
            <div class="form-field">
              <label for="editEquipName">장비명</label>
              <input type="text" id="editEquipName" />
            </div>
            <div class="form-field">
              <label for="editManager">담당자</label>
              <input type="text" id="editManager" />
            </div>
            <div class="form-field">
              <label for="editLocation">위치</label>
              <input type="text" id="editLocation" />
            </div>
            <div class="form-field">
              <label for="editStatus">상태</label>
              <select id="editStatus">
                <option value="정상">정상</option>
                <option value="점검중">점검중</option>
                <option value="장애">장애</option>
              </select>
            </div>
          </div>
          <div class="form-actions">
            <button id="btnSaveEdit" class="primary-btn">수정 저장</button>
            <span class="muted-text"
              >※ “장비 조회”에서 <b>상세수정</b> 버튼을 클릭하면 이 화면으로
              이동합니다.</span
            >
          </div>
        </section>
      </main>
    </div>

    <script>
      const apiBase = "/api/equipments";

      // 뷰 전환
      const views = {
        register: document.getElementById("view-register"),
        list: document.getElementById("view-list"),
        edit: document.getElementById("view-edit"),
      };
      const tabs = document.querySelectorAll(".nav-tab");

      function showView(viewName) {
        Object.keys(views).forEach((k) => {
          views[k].classList.toggle("active", k === viewName);
        });
        tabs.forEach((tab) => {
          tab.classList.toggle("active", tab.dataset.view === viewName);
        });

        if (viewName === "list") {
          loadEquipments();
        }
      }

      tabs.forEach((tab) => {
        tab.addEventListener("click", () => {
          const v = tab.dataset.view;
          showView(v);
        });
      });

      // 장비 목록 조회
      async function loadEquipments() {
        const tbody = document.getElementById("equipmentBody");
        tbody.innerHTML = '<tr><td colspan="7">불러오는 중...</td></tr>';

        try {
          const res = await fetch(apiBase);
          if (!res.ok) throw new Error("장비 목록 조회 실패");
          const data = await res.json();

          if (data.length === 0) {
            tbody.innerHTML =
              '<tr><td colspan="7">등록된 장비가 없습니다.</td></tr>';
            return;
          }

          tbody.innerHTML = "";
          data.forEach((e) => {
            const tr = document.createElement("tr");

            // 상세수정용 데이터 저장
            tr.dataset.id = e.EQUIP_ID;
            tr.dataset.name = e.EQUIP_NAME || "";
            tr.dataset.manager = e.MANAGER || "";
            tr.dataset.location = e.LOCATION || "";
            tr.dataset.status = e.STATUS || "";

            let statusClass = "";
            if (e.STATUS === "정상") statusClass = "status-normal";
            else if (e.STATUS === "점검중") statusClass = "status-check";
            else if (e.STATUS === "장애") statusClass = "status-error";

            tr.innerHTML = `
            <td>${e.EQUIP_ID}</td>
            <td>${e.EQUIP_NAME || ""}</td>
            <td>${e.MANAGER || ""}</td>
            <td>${e.LOCATION || ""}</td>
            <td><span class="${statusClass}">${e.STATUS}</span></td>
            <td>${e.UPDATED_AT || ""}</td>
            <td class="td-actions">
              <button data-action="detail" data-id="${
                e.EQUIP_ID
              }">상세수정</button>
              <button data-action="delete" data-id="${e.EQUIP_ID}">삭제</button>
            </td>
          `;

            tbody.appendChild(tr);
          });
        } catch (err) {
          console.error(err);
          tbody.innerHTML =
            '<tr><td colspan="7">목록 로딩 중 오류가 발생했습니다.</td></tr>';
        }
      }

      // 장비 등록
      async function addEquipment() {
        const equipName = document.getElementById("equipName").value.trim();
        const manager = document.getElementById("manager").value.trim();
        const location = document.getElementById("location").value.trim();
        const status = document.getElementById("status").value;

        if (!equipName) {
          alert("장비명을 입력해주세요.");
          return;
        }

        try {
          const res = await fetch(apiBase, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ equipName, manager, status, location }),
          });

          const resJson = await res.json();
          if (!res.ok) {
            alert("등록 실패: " + (resJson.message || "알 수 없는 오류"));
            return;
          }

          alert(resJson.message || "등록 완료");
          document.getElementById("equipName").value = "";
          document.getElementById("manager").value = "";
          document.getElementById("location").value = "";
          document.getElementById("status").value = "정상";

          // 등록 후 조회 탭으로 이동
          showView("list");
        } catch (err) {
          console.error(err);
          alert("등록 중 오류가 발생했습니다.");
        }
      }

      document.getElementById("btnAdd").addEventListener("click", addEquipment);
      document
        .getElementById("btnRefresh")
        .addEventListener("click", loadEquipments);

      // 리스트에서 버튼(상세수정/삭제)
      let editingId = null;

      document
        .getElementById("equipmentBody")
        .addEventListener("click", async (e) => {
          const btn = e.target;
          const action = btn.getAttribute("data-action");
          const id = btn.getAttribute("data-id");
          if (!action || !id) return;

          if (action === "delete") {
            if (!confirm("정말 삭제하시겠습니까?")) return;
            await deleteEquipment(id);
          } else if (action === "detail") {
            const tr = btn.closest("tr");
            openEditFromRow(tr);
          }
        });

      async function deleteEquipment(id) {
        try {
          const res = await fetch(`${apiBase}/${id}`, { method: "DELETE" });
          const resJson = await res.json();
          if (!res.ok) {
            alert("삭제 실패: " + (resJson.message || "알 수 없는 오류"));
            return;
          }
          alert(resJson.message || "삭제 완료");
          loadEquipments();
        } catch (err) {
          console.error(err);
          alert("삭제 중 오류가 발생했습니다.");
        }
      }

      // 상세수정 화면으로 이동 + 값 채우기
      function openEditFromRow(tr) {
        editingId = tr.dataset.id;
        document.getElementById("editEquipName").value = tr.dataset.name || "";
        document.getElementById("editManager").value = tr.dataset.manager || "";
        document.getElementById("editLocation").value =
          tr.dataset.location || "";
        document.getElementById("editStatus").value =
          tr.dataset.status || "정상";

        const info = document.getElementById("edit-info");
        info.innerHTML = `선택된 장비 ID <span>#${editingId}</span>`;

        showView("edit");
      }

      // 수정 저장
      async function saveEdit() {
        if (!editingId) {
          alert("먼저 “장비 조회”에서 상세수정을 선택해주세요.");
          return;
        }

        const equipName = document.getElementById("editEquipName").value.trim();
        const manager = document.getElementById("editManager").value.trim();
        const location = document.getElementById("editLocation").value.trim();
        const status = document.getElementById("editStatus").value;

        if (!equipName) {
          alert("장비명은 비울 수 없습니다.");
          return;
        }

        try {
          const res = await fetch(`${apiBase}/${editingId}`, {
            method: "PUT",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ equipName, manager, location, status }),
          });
          const resJson = await res.json();
          if (!res.ok) {
            alert("수정 실패: " + (resJson.message || "알 수 없는 오류"));
            return;
          }
          alert(resJson.message || "수정 완료");

          // 수정 후 조회 탭으로 이동
          editingId = null;
          document.getElementById("edit-info").textContent = "선택된 장비 없음";
          showView("list");
        } catch (err) {
          console.error(err);
          alert("수정 중 오류가 발생했습니다.");
        }
      }

      document
        .getElementById("btnSaveEdit")
        .addEventListener("click", saveEdit);

      // 처음 로딩 시 조회 탭 + 목록
      showView("list");
    </script>
  </body>
</html>
